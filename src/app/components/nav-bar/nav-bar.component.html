<nav class="nav-container" [ngClass]="containerClasses()" [style.--nav-bg]="backgroundColor()"
    [style.--nav-blur]="blurAmount()" [style.--nav-border-color]="borderColor()" [style.--nav-radius]="borderRadius()"
    [style.--nav-text-color]="textColor()" [style.--nav-top-offset]="topOffset()" [style.--nav-font]="fontFamily()"
    [style.--menu-padding]="menuPadding()">

    <!-- Left: Logo Slot or Default -->
    <div class="nav-left">
        <ng-content select="[nav-logo]"></ng-content>
        @if (!hasLogoSlot) {
        <a [href]="logo().link || '/'" class="logo-link">
            @if (logo().src) {
            <img [src]="logo().src" [alt]="logo().alt || 'Logo'" class="logo-img">
            } @else {
            <span class="logo-text">{{ logo().text }}</span>
            }
        </a>
        }
    </div>

    <!-- Center: Menu Slot or Default -->
    <div class="nav-center">
        <ng-content select="[nav-menu]"></ng-content>
        @if (!hasMenuSlot && menuItems().length > 0) {
        <ul class="menu-list">
            @for (item of menuItems(); track item.label) {
            <li class="menu-item" [class.has-dropdown]="item.children?.length">
                @if (item.children?.length) {
                <div class="menu-link dropdown-trigger">
                    {{ item.label }}
                    <svg width="10" height="6" viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round" class="dropdown-arrow">
                        <path d="M1 1L5 5L9 1" />
                    </svg>
                </div>
                <ul class="dropdown-menu">
                    @for (child of item.children; track child.label) {
                    <li class="dropdown-item">
                        <a [href]="child.link" class="dropdown-link" target="_blank" rel="noopener noreferrer">
                            {{ child.label }}
                        </a>
                    </li>
                    }
                </ul>
                } @else {
                <a [href]="item.link" class="menu-link">
                    {{ item.label }}
                </a>
                }
            </li>
            }
        </ul>
        }
    </div>

    <!-- Right: Actions Slot or Default -->
    <div class="nav-right">
        <!-- Hamburger Menu (Mobile Only) -->
        <button class="hamburger-btn" (click)="toggleMobileMenu()" [class.active]="mobileMenuOpen()"
            [style.visibility]="mobileMenuOpen() ? 'hidden' : 'visible'" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <ng-content select="[nav-actions]"></ng-content>
        @if (!hasActionsSlot) {
        @if (showLangPicker()) {
        <div class="lang-picker">
            <span class="lang-label">EN</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        </div>
        }

        @if (cta()) {
        <a [href]="cta()?.link" class="cta-button" [style.--cta-bg]="ctaColor()" [style.--cta-text]="ctaTextColor()">
            {{ cta()?.label }}
            <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg"
                class="arrow-icon">
                <path d="M1 9L9 1M9 1H3M9 1V7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </a>
        }
        }
    </div>
</nav>

<!-- Mobile Menu Overlay -->
<div class="mobile-menu-overlay" [class.open]="mobileMenuOpen()">
    <button class="close-menu-btn" (click)="closeMobileMenu()" aria-label="Close menu">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
    </button>
    <div class="mobile-menu-content">
        <ul class="mobile-nav-list">
            @for (item of menuItems(); track item.label) {
            <li class="mobile-nav-item" [class.has-children]="item.children?.length">
                @if (item.children?.length) {
                <div class="mobile-nav-link dropdown-toggle" (click)="toggleSubmenu(item.label, $event)">
                    {{ item.label }}
                    <svg width="12" height="8" viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="2"
                        [style.transform]="expandedSubmenu() === item.label ? 'rotate(180deg)' : 'rotate(0)'"
                        style="transition: transform 0.3s ease;">
                        <path d="M1 1L5 5L9 1" />
                    </svg>
                </div>
                <ul class="mobile-submenu" [class.open]="expandedSubmenu() === item.label">
                    @for (child of item.children; track child.label) {
                    <li class="mobile-submenu-item">
                        <a [href]="child.link" class="mobile-submenu-link" target="_blank" rel="noopener noreferrer"
                            (click)="closeMobileMenu()">
                            {{ child.label }}
                        </a>
                    </li>
                    }
                </ul>
                } @else {
                <a [href]="item.link" class="mobile-nav-link" (click)="closeMobileMenu()">
                    {{ item.label }}
                </a>
                }
            </li>
            }
        </ul>

        <!-- Mobile Actions Copy -->
        <div class="mobile-actions">
            @if (cta()) {
            <a [href]="cta()?.link" class="cta-button mobile-cta" (click)="closeMobileMenu()">
                {{ cta()?.label }}
            </a>
            }
        </div>
    </div>
</div>